---
import BaseHead from '../../components/BaseHead.astro';
import Header from '../../components/Header.astro';
import Footer from '../../components/Footer.astro';
import { SITE_TITLE } from '../../consts';
import { getCollection } from 'astro:content';
import { Image } from 'astro:assets';

const posts = (await getCollection('blog')).sort(
	(a, b) => b.data.pubDate.valueOf() - a.data.pubDate.valueOf(),
);
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Blog - ${SITE_TITLE}`} description="Thoughts on software development, technology, and building products." />
	</head>
	<body>
		<Header />
		<main>
			<section class="page-header">
				<div class="container">
					<span class="section-label">Insights</span>
					<h1>Blog</h1>
					<p class="page-intro">Thoughts on software development, technology, and building products.</p>
				</div>
			</section>

			<section class="posts">
				<div class="container">
					{posts.length === 0 ? (
						<div class="empty-state">
							<p>New posts coming soon.</p>
							<a href="/" class="btn btn--outline">Back to Home</a>
						</div>
					) : (
						<div class="posts-grid">
							{posts.map((post, index) => (
								<a href={`/blog/${post.id}/`} class:list={['post-card', { featured: index === 0 }]}>
									{post.data.heroImage && (
										<div class="post-image">
											<Image
												width={index === 0 ? 1200 : 600}
												height={index === 0 ? 600 : 400}
												src={post.data.heroImage}
												alt=""
											/>
										</div>
									)}
									<div class="post-content">
										<time datetime={post.data.pubDate.toISOString()}>
											{post.data.pubDate.toLocaleDateString('en-us', { year: 'numeric', month: 'long', day: 'numeric' })}
										</time>
										<h2>{post.data.title}</h2>
										<p>{post.data.description}</p>
									</div>
								</a>
							))}
						</div>
					)}
				</div>
			</section>
		</main>
		<Footer />
	</body>
</html>

<style>
	.page-header {
		padding: var(--space-xl) 0 var(--space-lg);
		border-bottom: none;
	}

	.page-intro {
		font-size: 1.125rem;
		color: var(--text-muted);
		max-width: 500px;
		margin: 0;
	}

	.posts {
		padding-top: 0;
	}

	.empty-state {
		text-align: center;
		padding: var(--space-xl) 0;
	}

	.empty-state p {
		color: var(--text-muted);
		font-size: 1.125rem;
		margin-bottom: var(--space-md);
	}

	.posts-grid {
		display: grid;
		grid-template-columns: repeat(2, 1fr);
		gap: var(--space-md);
	}

	.post-card {
		display: block;
		background: var(--cream-dark);
		text-decoration: none;
		transition: transform 0.3s ease;
	}

	.post-card:hover {
		transform: translateY(-4px);
	}

	.post-card.featured {
		grid-column: 1 / -1;
	}

	.post-image {
		overflow: hidden;
	}

	.post-image img {
		width: 100%;
		height: 280px;
		object-fit: cover;
		display: block;
		transition: transform 0.4s ease;
	}

	.post-card.featured .post-image img {
		height: 400px;
	}

	.post-card:hover .post-image img {
		transform: scale(1.03);
	}

	.post-content {
		padding: var(--space-md);
	}

	.post-content time {
		font-family: var(--font-display);
		font-size: 0.75rem;
		font-weight: 500;
		color: var(--accent);
		text-transform: uppercase;
		letter-spacing: 0.05em;
	}

	.post-content h2 {
		font-size: 1.5rem;
		color: var(--ink);
		margin: 0.75rem 0;
		transition: color 0.3s ease;
	}

	.post-card.featured .post-content h2 {
		font-size: 2rem;
	}

	.post-card:hover .post-content h2 {
		color: var(--accent);
	}

	.post-content p {
		color: var(--text-muted);
		font-size: 0.9375rem;
		margin: 0;
		line-height: 1.6;
	}

	@media (max-width: 768px) {
		.posts-grid {
			grid-template-columns: 1fr;
		}

		.post-image img,
		.post-card.featured .post-image img {
			height: 220px;
		}

		.post-card.featured .post-content h2 {
			font-size: 1.5rem;
		}
	}
</style>
