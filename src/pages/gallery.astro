---
import BaseHead from '../components/BaseHead.astro';
import Header from '../components/Header.astro';
import Footer from '../components/Footer.astro';
import { SITE_TITLE } from '../consts';
---

<!doctype html>
<html lang="en">
	<head>
		<BaseHead title={`Gallery - ${SITE_TITLE}`} description="Image gallery showcasing creative works" />
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Cormorant+Garamond:ital,wght@0,300;0,400;0,500;1,300;1,400&display=swap" rel="stylesheet">
	</head>
	<body>
		<Header />
		<main>
			<section class="gallery-section">
				<div class="container">
					<header class="page-header">
						<div class="header-content">
							<span class="section-label">Collection</span>
							<h1>Gallery</h1>
						</div>
						<div class="header-controls">
							<div class="collection-filter">
								<button class="filter-btn active" data-collection="all">All</button>
								<button class="filter-btn" data-collection="art">Art</button>
								<button class="filter-btn" data-collection="photography">Photography</button>
							</div>
							<div class="view-toggle">
								<button class="toggle-btn active" data-view="grid" aria-label="Grid view">
									<svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.5">
										<rect x="1" y="1" width="6" height="6" rx="1"/>
										<rect x="11" y="1" width="6" height="6" rx="1"/>
										<rect x="1" y="11" width="6" height="6" rx="1"/>
										<rect x="11" y="11" width="6" height="6" rx="1"/>
									</svg>
								</button>
								<button class="toggle-btn" data-view="masonry" aria-label="Masonry view">
									<svg width="18" height="18" viewBox="0 0 18 18" fill="none" stroke="currentColor" stroke-width="1.5">
										<rect x="1" y="1" width="6" height="8" rx="1"/>
										<rect x="11" y="1" width="6" height="5" rx="1"/>
										<rect x="1" y="12" width="6" height="5" rx="1"/>
										<rect x="11" y="9" width="6" height="8" rx="1"/>
									</svg>
								</button>
							</div>
						</div>
					</header>

					<div class="gallery-loading" id="gallery-loading">
						<div class="loader"></div>
						<p>Loading gallery...</p>
					</div>

					<div class="gallery-empty" id="gallery-empty" style="display: none;">
						<div class="empty-icon">
							<svg width="64" height="64" viewBox="0 0 64 64" fill="none" stroke="currentColor" stroke-width="1.5">
								<rect x="8" y="12" width="48" height="40" rx="4"/>
								<circle cx="24" cy="28" r="6"/>
								<path d="M8 44 L24 32 L36 40 L56 24"/>
							</svg>
						</div>
						<h2>No artwork yet</h2>
						<p>Check back soon for new pieces.</p>
					</div>

					<div class="gallery-grid" id="gallery-grid"></div>
				</div>
			</section>
		</main>
		<Footer />

		<!-- Lightbox Overlay -->
		<div class="lightbox" id="lightbox" aria-hidden="true">
			<div class="lightbox-backdrop"></div>

			<button class="lightbox-close" aria-label="Close gallery">
				<svg width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
					<line x1="18" y1="6" x2="6" y2="18"/>
					<line x1="6" y1="6" x2="18" y2="18"/>
				</svg>
			</button>

			<div class="lightbox-counter">
				<span id="current-index">1</span>
				<span class="counter-divider">/</span>
				<span id="total-count">0</span>
			</div>

			<button class="lightbox-nav lightbox-prev" aria-label="Previous image">
				<svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
					<polyline points="20,6 10,16 20,26"/>
				</svg>
			</button>

			<button class="lightbox-nav lightbox-next" aria-label="Next image">
				<svg width="32" height="32" viewBox="0 0 32 32" fill="none" stroke="currentColor" stroke-width="2">
					<polyline points="12,6 22,16 12,26"/>
				</svg>
			</button>

			<div class="lightbox-stage">
				<figure class="lightbox-figure">
					<canvas id="lightbox-canvas"></canvas>
					<figcaption class="lightbox-caption">
						<h3 id="lightbox-title"></h3>
						<div class="lightbox-meta">
							<span id="lightbox-medium"></span>
							<span id="lightbox-date"></span>
						</div>
						<p id="lightbox-notes"></p>
					</figcaption>
				</figure>
			</div>

			<nav class="thumbnail-strip" id="thumbnail-strip">
				<div class="thumbnail-track" id="thumbnail-track"></div>
			</nav>
		</div>
	</body>
</html>

<style>
	/* Gallery Section */
	.gallery-section {
		padding: var(--space-md) 0 var(--space-xl);
		min-height: 60vh;
	}

	.page-header {
		display: flex;
		justify-content: space-between;
		align-items: flex-end;
		margin-bottom: var(--space-lg);
		padding-bottom: var(--space-md);
		border-bottom: 1px solid var(--border);
		flex-wrap: wrap;
		gap: 1rem;
	}

	.header-content {
		display: flex;
		flex-direction: column;
		gap: 0.25rem;
	}

	.page-header h1 {
		font-family: 'Cormorant Garamond', serif;
		font-size: clamp(2.5rem, 6vw, 4rem);
		font-weight: 300;
		letter-spacing: -0.02em;
		margin: 0;
		line-height: 1;
	}

	.header-controls {
		display: flex;
		align-items: center;
		gap: 1rem;
	}

	.collection-filter {
		display: flex;
		gap: 0.25rem;
		padding: 0.25rem;
		background: var(--cream-dark);
		border-radius: 6px;
	}

	.filter-btn {
		background: transparent;
		border: none;
		padding: 0.5rem 1rem;
		font-family: var(--font-display);
		font-size: 0.6875rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		color: var(--text-muted);
		border-radius: 4px;
		cursor: pointer;
		transition: all 0.2s;
	}

	.filter-btn:hover {
		color: var(--ink);
	}

	.filter-btn.active {
		background: white;
		color: var(--ink);
		box-shadow: 0 1px 3px rgba(0,0,0,0.08);
	}

	.view-toggle {
		display: flex;
		gap: 0.25rem;
		padding: 0.25rem;
		background: var(--cream-dark);
		border-radius: 6px;
	}

	.toggle-btn {
		display: flex;
		align-items: center;
		justify-content: center;
		width: 40px;
		height: 40px;
		background: transparent;
		border: none;
		border-radius: 4px;
		color: var(--text-muted);
		cursor: pointer;
		transition: all 0.2s ease;
	}

	.toggle-btn:hover {
		color: var(--ink);
	}

	.toggle-btn.active {
		background: white;
		color: var(--ink);
		box-shadow: 0 1px 3px rgba(0,0,0,0.08);
	}

	/* Loading State */
	.gallery-loading {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: var(--space-xl) 0;
		gap: var(--space-sm);
	}

	.loader {
		width: 32px;
		height: 32px;
		border: 2px solid var(--cream-dark);
		border-top-color: var(--accent);
		border-radius: 50%;
		animation: spin 0.8s linear infinite;
	}

	@keyframes spin {
		to { transform: rotate(360deg); }
	}

	.gallery-loading p {
		font-family: var(--font-display);
		font-size: 0.875rem;
		color: var(--text-muted);
		letter-spacing: 0.02em;
	}

	/* Empty State */
	.gallery-empty {
		display: flex;
		flex-direction: column;
		align-items: center;
		justify-content: center;
		padding: var(--space-xl) 0;
		text-align: center;
	}

	.empty-icon {
		color: var(--gray-300);
		margin-bottom: var(--space-md);
	}

	.gallery-empty h2 {
		font-family: 'Cormorant Garamond', serif;
		font-size: 1.75rem;
		font-weight: 400;
		margin: 0 0 0.5rem 0;
	}

	.gallery-empty p {
		color: var(--text-muted);
		margin: 0;
	}

	/* Gallery Grid */
	.gallery-grid {
		display: grid;
		grid-template-columns: repeat(3, 1fr);
		gap: 1rem;
		opacity: 0;
		transition: opacity 0.4s ease;
	}

	.gallery-grid.loaded {
		opacity: 1;
	}

	.gallery-grid.masonry {
		display: block;
		column-count: 3;
		column-gap: 1rem;
	}

	/* Gallery Item */
	.gallery-item {
		position: relative;
		overflow: hidden;
		background: var(--cream-dark);
		cursor: pointer;
		break-inside: avoid;
		margin-bottom: 1rem;
	}

	.gallery-grid:not(.masonry) .gallery-item {
		aspect-ratio: 1;
	}

	.gallery-item::before {
		content: '';
		position: absolute;
		inset: 0;
		background: linear-gradient(
			to top,
			rgba(10, 10, 10, 0.7) 0%,
			rgba(10, 10, 10, 0) 50%
		);
		opacity: 0;
		transition: opacity 0.3s ease;
		z-index: 1;
	}

	.gallery-item:hover::before {
		opacity: 1;
	}

	.gallery-item canvas {
		width: 100%;
		height: 100%;
		object-fit: cover;
		display: block;
		transition: transform 0.5s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.gallery-grid:not(.masonry) .gallery-item canvas {
		position: absolute;
		inset: 0;
	}

	.gallery-item:hover canvas {
		transform: scale(1.05);
	}

	.gallery-item-info {
		position: absolute;
		bottom: 0;
		left: 0;
		right: 0;
		padding: 1.25rem;
		z-index: 2;
		transform: translateY(8px);
		opacity: 0;
		transition: all 0.3s ease;
	}

	.gallery-item:hover .gallery-item-info {
		transform: translateY(0);
		opacity: 1;
	}

	.gallery-item-title {
		font-family: 'Cormorant Garamond', serif;
		font-size: 1.125rem;
		font-weight: 400;
		color: white;
		margin: 0;
		line-height: 1.3;
	}

	.gallery-item-meta {
		font-size: 0.75rem;
		color: rgba(255, 255, 255, 0.6);
		margin-top: 0.25rem;
	}

	/* Animation for staggered entry */
	.gallery-item {
		animation: fadeSlideUp 0.5s ease both;
	}

	@keyframes fadeSlideUp {
		from {
			opacity: 0;
			transform: translateY(20px);
		}
		to {
			opacity: 1;
			transform: translateY(0);
		}
	}

	/* Lightbox */
	.lightbox {
		position: fixed;
		inset: 0;
		z-index: 1000;
		display: flex;
		align-items: center;
		justify-content: center;
		visibility: hidden;
		pointer-events: none;
	}

	.lightbox.active {
		visibility: visible;
		pointer-events: auto;
	}

	.lightbox-backdrop {
		position: absolute;
		inset: 0;
		background: #0a0a0a;
		opacity: 0;
		transition: opacity 0.4s ease;
	}

	.lightbox.active .lightbox-backdrop {
		opacity: 1;
	}

	.lightbox-close {
		position: absolute;
		top: 1.5rem;
		right: 1.5rem;
		z-index: 10;
		display: flex;
		align-items: center;
		justify-content: center;
		width: 48px;
		height: 48px;
		background: transparent;
		border: none;
		color: rgba(255, 255, 255, 0.7);
		cursor: pointer;
		transition: all 0.2s ease;
		opacity: 0;
		transform: translateY(-10px);
	}

	.lightbox.active .lightbox-close {
		opacity: 1;
		transform: translateY(0);
		transition-delay: 0.2s;
	}

	.lightbox-close:hover {
		color: white;
		transform: scale(1.1);
	}

	.lightbox-counter {
		position: absolute;
		top: 1.75rem;
		left: 1.5rem;
		z-index: 10;
		font-family: var(--font-display);
		font-size: 0.875rem;
		font-weight: 500;
		color: rgba(255, 255, 255, 0.5);
		letter-spacing: 0.1em;
		opacity: 0;
		transform: translateY(-10px);
		transition: all 0.3s ease;
	}

	.lightbox.active .lightbox-counter {
		opacity: 1;
		transform: translateY(0);
		transition-delay: 0.25s;
	}

	.counter-divider {
		margin: 0 0.25rem;
		opacity: 0.5;
	}

	/* Navigation Arrows */
	.lightbox-nav {
		position: absolute;
		top: 50%;
		transform: translateY(-50%);
		z-index: 10;
		display: flex;
		align-items: center;
		justify-content: center;
		width: 64px;
		height: 64px;
		background: transparent;
		border: none;
		color: rgba(255, 255, 255, 0.5);
		cursor: pointer;
		transition: all 0.2s ease;
		opacity: 0;
	}

	.lightbox.active .lightbox-nav {
		opacity: 1;
		transition-delay: 0.3s;
	}

	.lightbox-nav:hover {
		color: white;
	}

	.lightbox-prev {
		left: 1rem;
	}

	.lightbox-next {
		right: 1rem;
	}

	.lightbox-prev:hover {
		transform: translateY(-50%) translateX(-4px);
	}

	.lightbox-next:hover {
		transform: translateY(-50%) translateX(4px);
	}

	/* Lightbox Stage */
	.lightbox-stage {
		position: relative;
		width: 100%;
		height: 100%;
		display: flex;
		align-items: center;
		justify-content: center;
		padding: 5rem 6rem 7rem;
	}

	.lightbox-figure {
		position: relative;
		max-width: 100%;
		max-height: 100%;
		margin: 0;
		opacity: 0;
		transform: scale(0.95);
		transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
	}

	.lightbox.active .lightbox-figure {
		opacity: 1;
		transform: scale(1);
		transition-delay: 0.1s;
	}

	#lightbox-canvas {
		max-width: 100%;
		max-height: calc(100vh - 12rem);
		display: block;
		box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
	}

	.lightbox-caption {
		position: absolute;
		bottom: 0;
		left: 0;
		transform: translateY(calc(100% + 1rem));
		color: white;
		max-width: 400px;
	}

	.lightbox-caption h3 {
		font-family: 'Cormorant Garamond', serif;
		font-size: 1.25rem;
		font-weight: 400;
		margin: 0 0 0.5rem 0;
		color: rgba(255, 255, 255, 0.9);
	}

	.lightbox-meta {
		display: flex;
		gap: 1rem;
		margin-bottom: 0.5rem;
	}

	.lightbox-meta span {
		font-family: var(--font-display);
		font-size: 0.6875rem;
		font-weight: 600;
		text-transform: uppercase;
		letter-spacing: 0.05em;
		color: rgba(255, 255, 255, 0.5);
	}

	.lightbox-meta span:first-child {
		color: var(--accent-light);
	}

	.lightbox-caption p {
		font-size: 0.875rem;
		color: rgba(255, 255, 255, 0.5);
		margin: 0;
		line-height: 1.5;
	}

	/* Thumbnail Strip */
	.thumbnail-strip {
		position: absolute;
		bottom: 0;
		left: 0;
		right: 0;
		height: 80px;
		background: linear-gradient(to top, rgba(0, 0, 0, 0.8) 0%, transparent 100%);
		padding: 1rem 6rem;
		overflow: hidden;
		opacity: 0;
		transform: translateY(20px);
		transition: all 0.3s ease;
	}

	.lightbox.active .thumbnail-strip {
		opacity: 1;
		transform: translateY(0);
		transition-delay: 0.35s;
	}

	.thumbnail-track {
		display: flex;
		gap: 0.5rem;
		height: 100%;
		overflow-x: auto;
		overflow-y: hidden;
		scroll-behavior: smooth;
		scrollbar-width: none;
		-ms-overflow-style: none;
		padding: 0 calc(50% - 28px);
	}

	.thumbnail-track::-webkit-scrollbar {
		display: none;
	}

	.thumbnail-item {
		flex-shrink: 0;
		width: 56px;
		height: 56px;
		border-radius: 4px;
		overflow: hidden;
		cursor: pointer;
		opacity: 0.4;
		transition: all 0.2s ease;
		border: 2px solid transparent;
		background: #333;
	}

	.thumbnail-item:hover {
		opacity: 0.8;
	}

	.thumbnail-item.active {
		opacity: 1;
		border-color: var(--accent);
	}

	.thumbnail-item canvas {
		width: 100%;
		height: 100%;
		object-fit: cover;
	}

	/* Responsive */
	@media (max-width: 968px) {
		.gallery-grid {
			grid-template-columns: repeat(2, 1fr);
		}

		.gallery-grid.masonry {
			column-count: 2;
		}

		.lightbox-stage {
			padding: 4rem 3rem 6rem;
		}

		.thumbnail-strip {
			padding: 1rem 3rem;
		}
	}

	@media (max-width: 640px) {
		.page-header {
			flex-direction: column;
			align-items: flex-start;
			gap: var(--space-sm);
		}

		.header-controls {
			width: 100%;
			justify-content: space-between;
		}

		.gallery-grid {
			grid-template-columns: 1fr;
			gap: 0.75rem;
		}

		.gallery-grid.masonry {
			column-count: 1;
		}

		.lightbox-nav {
			width: 48px;
			height: 48px;
		}

		.lightbox-prev {
			left: 0.5rem;
		}

		.lightbox-next {
			right: 0.5rem;
		}

		.lightbox-stage {
			padding: 3rem 1rem 5rem;
		}

		.thumbnail-strip {
			padding: 0.75rem 1rem;
			height: 70px;
		}

		.thumbnail-item {
			width: 44px;
			height: 44px;
		}

		.thumbnail-track {
			padding: 0 calc(50% - 22px);
		}

		.lightbox-caption {
			max-width: 100%;
			padding-right: 1rem;
		}
	}
</style>

<script>
	interface GalleryItem {
		id: string;
		title: string;
		date: string;
		medium?: string;
		notes?: string;
		filename: string;
		collection?: string;
	}

	let items: GalleryItem[] = [];
	let filteredItems: GalleryItem[] = [];
	let currentIndex = 0;
	let currentCollection = 'all';

	const grid = document.getElementById('gallery-grid') as HTMLElement;
	const loading = document.getElementById('gallery-loading') as HTMLElement;
	const empty = document.getElementById('gallery-empty') as HTMLElement;
	const lightbox = document.getElementById('lightbox') as HTMLElement;
	const lightboxCanvas = document.getElementById('lightbox-canvas') as HTMLCanvasElement;
	const lightboxTitle = document.getElementById('lightbox-title') as HTMLElement;
	const lightboxMedium = document.getElementById('lightbox-medium') as HTMLElement;
	const lightboxDate = document.getElementById('lightbox-date') as HTMLElement;
	const lightboxNotes = document.getElementById('lightbox-notes') as HTMLElement;
	const currentIndexEl = document.getElementById('current-index') as HTMLElement;
	const totalCountEl = document.getElementById('total-count') as HTMLElement;
	const thumbnailTrack = document.getElementById('thumbnail-track') as HTMLElement;

	// View toggle
	const toggleBtns = document.querySelectorAll('.toggle-btn');
	toggleBtns.forEach(btn => {
		btn.addEventListener('click', () => {
			const view = (btn as HTMLElement).dataset.view;
			toggleBtns.forEach(b => b.classList.remove('active'));
			btn.classList.add('active');

			if (view === 'masonry') {
				grid.classList.add('masonry');
			} else {
				grid.classList.remove('masonry');
			}
		});
	});

	// Collection filter
	const filterBtns = document.querySelectorAll('.filter-btn');
	filterBtns.forEach(btn => {
		btn.addEventListener('click', () => {
			filterBtns.forEach(b => b.classList.remove('active'));
			btn.classList.add('active');
			currentCollection = (btn as HTMLElement).dataset.collection || 'all';
			filterItems();
		});
	});

	// Fetch items
	async function fetchItems() {
		try {
			const response = await fetch('/api/gallery');
			const data = await response.json();

			if (data.error) {
				console.error('Gallery error:', data.error);
				loading.style.display = 'none';
				empty.style.display = 'flex';
				return;
			}

			items = data.items || [];

			loading.style.display = 'none';

			if (items.length === 0) {
				empty.style.display = 'flex';
				return;
			}

			filterItems();
		} catch (error) {
			console.error('Failed to fetch items:', error);
			loading.style.display = 'none';
			empty.style.display = 'flex';
		}
	}

	function filterItems() {
		filteredItems = currentCollection === 'all'
			? items
			: items.filter(item => item.collection === currentCollection);

		if (filteredItems.length === 0) {
			grid.innerHTML = '';
			grid.classList.remove('loaded');
			empty.style.display = 'flex';
		} else {
			empty.style.display = 'none';
			renderGrid();
			renderThumbnails();
			totalCountEl.textContent = String(filteredItems.length);
		}
	}

	// Render image to canvas (anti-scraping measure)
	async function renderImageToCanvas(canvas: HTMLCanvasElement, url: string): Promise<void> {
		return new Promise((resolve, reject) => {
			const img = new Image();
			img.crossOrigin = 'anonymous';

			img.onload = () => {
				canvas.width = img.naturalWidth;
				canvas.height = img.naturalHeight;
				const ctx = canvas.getContext('2d');
				if (ctx) {
					ctx.drawImage(img, 0, 0);
				}
				resolve();
			};

			img.onerror = reject;
			img.src = url;
		});
	}

	async function renderGrid() {
		grid.innerHTML = '';

		for (let index = 0; index < filteredItems.length; index++) {
			const item = filteredItems[index];
			const article = document.createElement('article');
			article.className = 'gallery-item';
			article.style.animationDelay = `${index * 0.05}s`;
			article.dataset.index = String(index);

			const canvas = document.createElement('canvas');
			canvas.style.backgroundColor = '#F0EBE3';

			const info = document.createElement('div');
			info.className = 'gallery-item-info';
			info.innerHTML = `
				<h3 class="gallery-item-title">${item.title}</h3>
				${item.medium ? `<p class="gallery-item-meta">${item.medium}</p>` : ''}
			`;

			article.appendChild(canvas);
			article.appendChild(info);
			article.addEventListener('click', () => openLightbox(index));
			grid.appendChild(article);

			// Load image asynchronously
			renderImageToCanvas(canvas, `/api/gallery/${item.id}/image`).catch(console.error);
		}

		requestAnimationFrame(() => {
			grid.classList.add('loaded');
		});
	}

	async function renderThumbnails() {
		thumbnailTrack.innerHTML = '';

		for (let index = 0; index < filteredItems.length; index++) {
			const item = filteredItems[index];
			const thumb = document.createElement('button');
			thumb.className = 'thumbnail-item';
			thumb.dataset.index = String(index);

			const canvas = document.createElement('canvas');
			thumb.appendChild(canvas);
			thumb.addEventListener('click', () => goToImage(index));
			thumbnailTrack.appendChild(thumb);

			// Load thumbnail
			renderImageToCanvas(canvas, `/api/gallery/${item.id}/image`).catch(console.error);
		}
	}

	async function openLightbox(index: number) {
		currentIndex = index;
		await updateLightboxImage();
		lightbox.classList.add('active');
		lightbox.setAttribute('aria-hidden', 'false');
		document.body.style.overflow = 'hidden';
	}

	function closeLightbox() {
		lightbox.classList.remove('active');
		lightbox.setAttribute('aria-hidden', 'true');
		document.body.style.overflow = '';
	}

	function goToImage(index: number) {
		if (index < 0) index = filteredItems.length - 1;
		if (index >= filteredItems.length) index = 0;
		currentIndex = index;
		updateLightboxImage();
	}

	async function updateLightboxImage() {
		const item = filteredItems[currentIndex];
		if (!item) return;

		// Render to canvas
		await renderImageToCanvas(lightboxCanvas, `/api/gallery/${item.id}/image`);

		// Update caption
		lightboxTitle.textContent = item.title;
		lightboxMedium.textContent = item.medium || '';
		lightboxDate.textContent = item.date ? new Date(item.date).getFullYear().toString() : '';
		lightboxNotes.textContent = item.notes || '';
		currentIndexEl.textContent = String(currentIndex + 1);

		// Update thumbnail highlight
		document.querySelectorAll('.thumbnail-item').forEach((thumb, i) => {
			thumb.classList.toggle('active', i === currentIndex);
		});

		// Scroll thumbnail into view
		const activeThumb = thumbnailTrack.children[currentIndex] as HTMLElement;
		if (activeThumb) {
			activeThumb.scrollIntoView({ behavior: 'smooth', inline: 'center', block: 'nearest' });
		}
	}

	// Event listeners
	document.querySelector('.lightbox-close')?.addEventListener('click', closeLightbox);
	document.querySelector('.lightbox-backdrop')?.addEventListener('click', closeLightbox);
	document.querySelector('.lightbox-prev')?.addEventListener('click', () => goToImage(currentIndex - 1));
	document.querySelector('.lightbox-next')?.addEventListener('click', () => goToImage(currentIndex + 1));

	// Keyboard navigation
	document.addEventListener('keydown', (e) => {
		if (!lightbox.classList.contains('active')) return;

		switch (e.key) {
			case 'Escape':
				closeLightbox();
				break;
			case 'ArrowLeft':
				goToImage(currentIndex - 1);
				break;
			case 'ArrowRight':
				goToImage(currentIndex + 1);
				break;
		}
	});

	// Prevent right-click on gallery
	grid.addEventListener('contextmenu', (e) => e.preventDefault());
	lightbox.addEventListener('contextmenu', (e) => e.preventDefault());

	// Initialize
	fetchItems();
</script>
